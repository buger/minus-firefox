<!DOCTYPE HTML>
<html>
    <head>
        <link rel="stylesheet" type="text/css" href="css/reset-min.css">
        <link rel="stylesheet" href="css/jquery.jscrollpane.css" />
        <link rel="stylesheet" href="css/options.css" />
    </head>
    <body>
        <form>
        <h1 class="header">
            <img src="images/logo_128.png" border="0"/>
            Extension configuration
        </h1>

        <div class="options" style="visibility: hidden">
            <div>
                <h3>Shortcuts</h3>
                <ul class="shortcuts">
                    <li>
                        <label>Visible Part of Page</label>
                        <span>Ctrl+Alt+</span>

                        <select id="visible_hotkey" name="hotkey_visible"><option value="">--</option><option value="A">A</option><option value="B">B</option><option value="C">C</option><option value="D">D</option><option value="E">E</option><option value="F">F</option><option value="G">G</option><option value="H">H</option><option value="I">I</option><option value="J">J</option><option value="K">K</option><option value="L">L</option><option value="M">M</option><option value="N">N</option><option value="O">O</option><option value="P">P</option><option value="Q">Q</option><option value="R">R</option><option value="S">S</option><option value="T">T</option><option value="U">U</option><option value="V">V</option><option value="W">W</option><option value="X">X</option><option value="Y">Y</option><option value="Z">Z</option></select>
                    </li>
                    <!--
                    <li>
                        <label>Selected Area</label>
                        <span>Ctrl+Alt+</span>

                        <select id="area_hotkey" name="hotkey_region"><option value="">--</option><option value="A">A</option><option value="B">B</option><option value="C">C</option><option value="D">D</option><option value="E">E</option><option value="F">F</option><option value="G">G</option><option value="H">H</option><option value="I">I</option><option value="J">J</option><option value="K">K</option><option value="L">L</option><option value="M">M</option><option value="N">N</option><option value="O">O</option><option value="P">P</option><option value="Q">Q</option><option value="R">R</option><option value="S">S</option><option value="T">T</option><option value="U">U</option><option value="V">V</option><option value="W">W</option><option value="X">X</option><option value="Y">Y</option><option value="Z">Z</option></select>
                    </li>
                    -->
                    <li>
                        <label>Entire Page</label>
                        <span>Ctrl+Alt+</span>

                        <select id="entire_hotkey" name="hotkey_full"><option value="">--</option><option value="A">A</option><option value="B">B</option><option value="C">C</option><option value="D">D</option><option value="E">E</option><option value="F">F</option><option value="G">G</option><option value="H">H</option><option value="I">I</option><option value="J">J</option><option value="K">K</option><option value="L">L</option><option value="M">M</option><option value="N">N</option><option value="O">O</option><option value="P">P</option><option value="Q">Q</option><option value="R">R</option><option value="S">S</option><option value="T">T</option><option value="U">U</option><option value="V">V</option><option value="W">W</option><option value="X">X</option><option value="Y">Y</option><option value="Z">Z</option></select>
                    </li>                                   
                </ul>
            </div>
        </div>
        </form>

        <script src="js/jquery.min.js"></script>
        <script src="js/store.js"></script>
        <script src="js/browser_api.js"></script>        
        <script>
            $('.shortcuts span').each(function(){
                if (browser.isPlatform('mac')) {
                    this.innerHTML = "Cmd+Alt+";
                } else {
                    this.innerHTML = "Ctrl+Alt+";
                }
            });            
            
            browser.onReady(function() {
                console.log('ready');
            });

            browser.addMessageListener(function() {
            });

            browser.postMessage({ 
                method: 'getSettings' 
            }, null,
            function(msg){
                initOptions(msg.response.settings);
            });

            
            function initOptions(storage) {
                $('#visible_hotkey').val(storage.shortcuts.visible.key);
                $('#entire_hotkey').val(storage.shortcuts.entire.key);

                $('.options').css({ 'visibility': 'visible' });

                $('#visible_hotkey, #entire_hotkey').bind('change', function(){
                    var data = $('form').serializeArray();

                    var shortcuts = {};

                    for (var i=0; i<data.length; i++) {
                        shortcuts[data[i].name] = data[i].value; 
                    }

                    browser.postMessage({ method: 'updateSettings', shortcuts: shortcuts });
                });
            }
        </script>
    </body>
</html>
